<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>ObjectMaker.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">citrusengine</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptBracket/Brace">{</span>    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">citrusengine</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CitrusEngine</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">citrusengine</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CitrusObject</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">citrusengine</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">State</span>;        <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MovieClip</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getDefinitionByName</span>;        <span class="ActionScriptASDoc">/**     * The ObjectMaker is a factory utility class for quickly and easily batch-creating a bunch of CitrusObjects.     * Usually the ObjectMaker is used if you laid out your level in a level editor or an XML file.     * Pass in your layout object (SWF, XML, or whatever else is supported in the future) to the appropriate method,     * and the method will return an array of created CitrusObjects.     *      * &lt;p&gt;The methods within the ObjectMaker should be called according to what kind of layout file that was created     * by your level editor.&lt;/p&gt;     */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">ObjectMaker</span>    <span class="ActionScriptBracket/Brace">{</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ObjectMaker</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>        <span class="ActionScriptBracket/Brace">{</span>        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * You can pass a custom-created MovieClip object into this method to auto-create CitrusObjects.         * This method looks at all the children of the MovieClip you passed in, and creates a CitrusObject with the         * x, y, width, height, name, and rotation of the of MovieClip.         *          * &lt;p&gt;In order for this to properly create a CitrusObject from a MovieClip, the MovieClip needs to have a variable         * called &lt;code&gt;classPath&lt;/code&gt; on it, which will provide, in String form, the full         * package and class name of the Citrus Object that it is supposed to create (such as "myGame.MyHero"). You can specify         * this in frame 1 of the MovieClip asset in Flash.&lt;/p&gt;         *          * &lt;p&gt;You can also initialize your CitrusObject's parameters by creating a "params" variable (of type Object)         * on your MovieClip. The "params" object will be passed into the newly created CitrusObject.&lt;/p&gt;         *          * &lt;p&gt;So, within the first frame of each child-MovieClip of the "layout" MovieClip,         * you should specify something like the following:&lt;/p&gt;         *          * &lt;p&gt;&lt;code&gt;var classPath="com.citrusEngine.objects.platformer.Hero";&lt;/code&gt;&lt;/p&gt;         *          * &lt;p&gt;&lt;code&gt;var params={view: "Patch.swf", jumpHeight: 14};&lt;/code&gt;&lt;/p&gt;         */</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">FromMovieClip</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mc</span>:<span class="ActionScriptDefault_Text">MovieClip</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">addToCurrentState</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Array</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numChildren</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">child</span>:<span class="ActionScriptDefault_Text">MovieClip</span>;            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">n</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptDefault_Text">child</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getChildAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MovieClip</span>;                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">className</span><span class="ActionScriptBracket/Brace">)</span>                        <span class="ActionScriptReserved">continue</span>;                                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">objectClass</span>:<span class="ActionScriptDefault_Text">Class</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getDefinitionByName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">className</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Class</span>;                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">params</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> {};                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">)</span>                        <span class="ActionScriptDefault_Text">params</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">params</span>;                                        <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;                    <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;                                        <span class="ActionScriptComment">//We need to unrotate the object to get its true width/height. Then rotate it back.</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rotation</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span>;                    <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> 0;                    <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>;                    <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span>;                    <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rotation</span>;                                        <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span>;                                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">CitrusObject</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">objectClass</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">)</span>;                    <span class="ActionScriptDefault_Text">a</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptBracket/Brace">}</span>            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">addToCurrentState</span><span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ce</span>:<span class="ActionScriptDefault_Text">CitrusEngine</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">CitrusEngine</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getInstance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">a</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">ce</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">state</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">add</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">a</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * This batch-creates CitrusObjects from an XML file generated by the level editor GLEED2D. If you would like to          * use GLEED2D as a level editor for your Citrus Engine game, call this function to parse your GLEED2D level.         *          * &lt;p&gt;When using GLEED2D, there are a few things to note:         * &lt;ul&gt;         * &lt;li&gt; You must add a custom property named 'className' for each object you make, unless it will be of the type         * specified in the &lt;code&gt;defaultClassName&lt;/code&gt; parameter. Assign this property a value         * that represents the class that you want that object to be. For example, if you wanted to make a hero, you must         * give your GLEED2D Hero 'className' property the value 'com.citrusengine.objects.platformer.Hero'. Don't forget         * to include the package, or the Citrus Engine won't be able to make your object.&lt;/li&gt;         * &lt;li&gt; You can shift-click and drag to duplicate GLEED2D objects. This is the easiest way to copy an entire object,         * custom-properties and all.&lt;/li&gt;         * &lt;li&gt; Unfortunately, GLEED2D does not support rotating the Rectangle Primitive, this makes GLEED2D difficult to use         * if you plan on using it to layout levels for a platformer with hills. You can, however, specify a custom property         * named "rotation", which will work in Citrus Engine, but not be reflected in GLEED2D.&lt;/li&gt;         * &lt;li&gt; GLEED2D does not support SWFs as textures, so any CitrusObjects that will use SWFs as their view should         * be created via a GLEED2D rectangle primitive, then specify the SWF path or MovieClip class name using a custom         * property named 'view'.         * &lt;/li&gt;         * &lt;/ul&gt;         * &lt;/p&gt;         *          * @param levelXML An XML level object created by GLEED2D.         * @param addToCurrentState Automatically adds all CitrusObjects that get created to the current state.         * @param layerIndexProperty Gleed's layer indexes will be assigned to the specified property.         * @param defaultClassName If a className custom property is not specified on a GLEED2D asset, this is the default CitrusObject class that gets created.         * @return An array of CitrusObjects. If the &lt;code&gt;addToCurrentState&lt;/code&gt; property is false, you will still need to add these to the state.         *          */</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">FromGleed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">levelXML</span>:<span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">,</span>                                         <span class="ActionScriptDefault_Text">addToCurrentState</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptOperator">,</span>                                         <span class="ActionScriptDefault_Text">layerIndexProperty</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"group"</span><span class="ActionScriptOperator">,</span>                                         <span class="ActionScriptDefault_Text">defaultClassName</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"com.citrusengine.objects.CitrusSprite"</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Array</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layerIndex</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">items</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">objectName</span>:<span class="ActionScriptDefault_Text">String</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ce</span>:<span class="ActionScriptDefault_Text">CitrusEngine</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">CitrusEngine</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getInstance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layerXML</span>:<span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">levelXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Layers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//Loop through all layers</span>            <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">itemXML</span>:<span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">layerXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Items</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Item</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//Loop through all items on a layer</span>                <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptComment">//Grab the XML properties we want off of the item node.</span>                    <span class="ActionScriptDefault_Text">objectName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">@</span><span class="ActionScriptDefault_Text">Name</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">X</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//Top for primitives, center for textures</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Y</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//Left for primitives, center for textures</span>                                        <span class="ActionScriptComment">//See if this object has a texture</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">viewString</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">texture_filename</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">viewString</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptString">""</span><span class="ActionScriptBracket/Brace">)</span>                    <span class="ActionScriptBracket/Brace">{</span>                        <span class="ActionScriptComment">//Create known params for a GLEED2D "texture"</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">originX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Origin</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">X</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">originY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Origin</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Y</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rotation</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Rotation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 180 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span>;                        <span class="ActionScriptDefault_Text">object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">x</span>: <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">y</span>: <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">width</span>: <span class="ActionScriptDefault_Text">originX</span> <span class="ActionScriptOperator">*</span> 2<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">height</span>: <span class="ActionScriptDefault_Text">originY</span> <span class="ActionScriptOperator">*</span> 2<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">rotation</span>: <span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">registration</span>: <span class="ActionScriptString">"center"</span><span class="ActionScriptBracket/Brace">}</span>;                        <span class="ActionScriptDefault_Text">viewString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">viewString</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">"\\"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">"/"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//covert backslashes to forward slashes</span>                        <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewString</span>;                    <span class="ActionScriptBracket/Brace">}</span>                    <span class="ActionScriptReserved">else</span>                    <span class="ActionScriptBracket/Brace">{</span>                        <span class="ActionScriptComment">//Create known params for a GLEED2D "primitive"</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">width</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Width</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">height</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Height</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                                                <span class="ActionScriptDefault_Text">object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">x</span>: <span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">y</span>: <span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">width</span>: <span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">height</span>: <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">}</span>;                    <span class="ActionScriptBracket/Brace">}</span>                                        <span class="ActionScriptComment">//Covert GLEED layer index to a property on the object.</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerIndexProperty</span><span class="ActionScriptBracket/Brace">)</span>                        <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">layerIndexProperty</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">layerIndex</span>;                                        <span class="ActionScriptComment">//Add the custom properties</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">className</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">defaultClassName</span>;                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">customPropXML</span>:<span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">itemXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CustomProperties</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Property</span><span class="ActionScriptBracket/Brace">)</span>                    <span class="ActionScriptBracket/Brace">{</span>                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">customPropXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">@</span><span class="ActionScriptDefault_Text">Name</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">"className"</span><span class="ActionScriptBracket/Brace">)</span>                            <span class="ActionScriptDefault_Text">className</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">customPropXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">string</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptReserved">else</span>                            <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">customPropXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">@</span><span class="ActionScriptDefault_Text">Name</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">customPropXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">string</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                    <span class="ActionScriptBracket/Brace">}</span>                                        <span class="ActionScriptComment">//Make the CitrusObject and add it to the current state.</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">citrusClass</span>:<span class="ActionScriptDefault_Text">Class</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getDefinitionByName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">className</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Class</span>;                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">citrusObject</span>:<span class="ActionScriptDefault_Text">CitrusObject</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">citrusClass</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">objectName</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">addToCurrentState</span><span class="ActionScriptBracket/Brace">)</span>                        <span class="ActionScriptDefault_Text">ce</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">state</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">add</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">citrusObject</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptDefault_Text">layerIndex</span><span class="ActionScriptOperator">++</span>;            <span class="ActionScriptBracket/Brace">}</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">items</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * This function batch-creates Citrus Engine game objects from an XML file generated by the Level Architect.         * If you are using the Level Architect as your level editor, call this function to parse the objects in         * your Level Architect level.         *          * @param    levelData The XML file (.lev) that the Level Architect generates.         * @param    addToCurrentState If true, the objects that are created will get added to the current state's object list.         * @return Returns an array containing all the objects that were created via this function.         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">FromLevelArchitect</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">levelData</span>:<span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">addToCurrentState</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Array</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">array</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">state</span>:<span class="ActionScriptDefault_Text">State</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">CitrusEngine</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getInstance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">state</span>;            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">objectXML</span>:<span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">levelData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CitrusObject</span><span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">params</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptBracket/Brace">}</span>;                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">paramXML</span>:<span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">objectXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Property</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">paramXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">@</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">paramXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">className</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">@</span><span class="ActionScriptDefault_Text">className</span>;                <span class="ActionScriptReserved">try</span>                <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">theClass</span>:<span class="ActionScriptDefault_Text">Class</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getDefinitionByName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">className</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Class</span>;                <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">catch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">errorID</span> <span class="ActionScriptOperator">==</span> 1065<span class="ActionScriptBracket/Brace">)</span>                    <span class="ActionScriptBracket/Brace">{</span>                        <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"You (yes, YOU) must import and create a reference to the "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">className</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">" class somewhere in your code. The Level Architect cannot create objects unless they are compiled into the SWF."</span><span class="ActionScriptBracket/Brace">)</span>;                    <span class="ActionScriptBracket/Brace">}</span>                    <span class="ActionScriptReserved">else</span>                    <span class="ActionScriptBracket/Brace">{</span>                        <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">e</span>;                    <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">theObject</span>:<span class="ActionScriptDefault_Text">CitrusObject</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">theClass</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">objectXML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">@</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptDefault_Text">array</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">theObject</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">addToCurrentState</span><span class="ActionScriptBracket/Brace">)</span>                    <span class="ActionScriptDefault_Text">state</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">add</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">theObject</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">array</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">str</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fnd</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">rpl</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">str</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fnd</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rpl</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>    <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
